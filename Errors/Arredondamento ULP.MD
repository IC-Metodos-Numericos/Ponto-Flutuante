# ARQUIVO EM DESENVOLVIMENTO

# Por que a opera√ß√£o `(x^{10} + 79) - x^{10}` n√£o retorna `79` para `x` grande?

# üìè O que √© ULP? (Unit in the Last Place)

**ULP** significa ‚ÄúUnidade na √öltima Posi√ß√£o‚Äù. √â a menor diferen√ßa entre dois n√∫meros consecutivos que o sistema de ponto flutuante consegue distinguir em determinada faixa.

## Por que o ULP importa?

√Ä medida que os n√∫meros aumentam, o espa√ßo entre dois valores consecutivos represent√°veis (ou seja, que podem ser armazenados) tamb√©m aumenta. O ULP √© justamente esse ‚Äúespa√ßo‚Äù entre n√∫meros represent√°veis.

- Para n√∫meros pequenos, o ULP √© muito pequeno (ex: $10^{-15}$).
- Para n√∫meros grandes, o ULP √© maior (ex: $10^{10}$, $10^{17}$, etc).

## Como calcular o ULP?

Para um n√∫mero $x$ em ponto flutuante IEEE 754 (float64):

$$
\text{ULP}(x) \approx 2^{e - 52}
$$

Onde:
- $e$ √© o expoente bin√°rio de $x$,
- 52 √© o n√∫mero de bits da mantissa (precis√£o da fra√ß√£o).

### Exemplo pr√°tico

Suponha $x = 2^{10} = 1024$:

$$
\text{ULP}(x) \approx 2^{10 - 52} = 2^{-42} \approx 2.27 \times 10^{-13}
$$

Ou seja, entre 1024 e o pr√≥ximo n√∫mero represent√°vel em float64, a diferen√ßa m√≠nima √© cerca de $2.27 \times 10^{-13}$.

### Visualiza√ß√£o

Imagine a reta dos n√∫meros reais:

```
... x, x + ULP(x), x + 2¬∑ULP(x), ...
```

Os n√∫meros represent√°veis est√£o separados por um intervalo de ULP ‚Äî n√£o √© poss√≠vel representar n√∫meros ‚Äúentre eles‚Äù exatamente.

---

## üí° Vis√£o geral: Arredondamento em Ponto Flutuante (IEEE 754)

A aritm√©tica em `float64` (IEEE 754 de dupla precis√£o) representa um n√∫mero assim:

```
valor = (-1)^s ¬∑ (1.mantissa) ¬∑ 2^expoente
```

- 1 bit para o sinal
- 11 bits para o expoente (com bias = 1023)
- 52 bits para a mantissa (fra√ß√£o bin√°ria)

Em cada faixa de expoente, s√≥ conseguimos representar n√∫meros m√∫ltiplos de uma certa "granularidade" ‚Äî essa granularidade √© a **ULP**.

---

## üîç O que √© ULP e por que ela importa aqui?

Se $x^{10}$ √© muito grande, ent√£o:

$$
\text{ULP}(x^{10}) \gg 1
$$

### O que pode acontecer com a opera√ß√£o $(x^{10} + 79) - x^{10}$?

- Se $79 < \text{ULP}(x^{10}) / 2$: a soma `+79` **√© ignorada completamente**. Resultado: `0.0`
- Se $\text{ULP}(x^{10}) / 2 < 79 < \text{ULP}(x^{10})$: a soma √© **arredondada para a ULP inteira mais pr√≥xima**. Resultado: `64.0`, `128.0`, etc.
- Se $79 \approx \text{ULP}(x^{10})$: pode acontecer arredondamento exato para a ULP. Resultado: `128.0`, por exemplo.
- Se $79 > \text{ULP}(x^{10})$: a opera√ß√£o funciona corretamente, resultado: `79.0`

A subtra√ß√£o `- x^{10}` retorna esse valor arredondado ou truncado, e **n√£o necessariamente o `79` original**.

---

## üß™ Exemplo pr√°tico com x = 60

Vamos calcular aproximadamente:

$$
x = 60 \Rightarrow x^{10} = 60^{10} \approx 6.05 \times 10^{17}
$$

### Como calcular a ULP?

Sabendo que $x^{10} \approx 6.05 \times 10^{17}$, esse n√∫mero est√° entre $2^{58} \approx 2.88 \times 10^{17}$ e $2^{59} \approx 5.76 \times 10^{17}$, ent√£o o expoente √© **59**.

$$
\text{ULP} \approx 2^{59 - 52} = 2^7 = 128.0
$$

### O que isso significa?

- `x^{10} + 79` n√£o consegue representar com precis√£o os `+79`, pois $79 < 128$
- O valor √© **arredondado para o n√∫mero represent√°vel mais pr√≥ximo**, que √© `x^{10} + 128`
- Ao subtrair `x^{10}`, o resultado final √©:

$$
(x^{10} + 128) - x^{10} = 128.0
$$

üåü **Exatamente o valor que aparece no experimento!**

---

## üîÅ Para outros valores de x

- Se $x^{10}$ estiver em uma faixa onde ULP $\approx 64$, o resultado ser√° `64.0`
- Se ULP $\approx 32$, o resultado ser√° `32.0`
- Se ULP $\approx 16$, o resultado ser√° `16.0`
- Se ULP $\approx 128$, o resultado ser√° `128.0`

A soma `+79` √© sempre aproximada pelo m√∫ltiplo mais pr√≥ximo da ULP ‚Äî nunca exatamente `79`, a menos que a ULP seja suficientemente menor que 79.

---

## üî≠ Por que o valor n√£o √© 79?

Porque:

> O n√∫mero 79 **n√£o pode ser representado com precis√£o** como a diferen√ßa entre dois n√∫meros muito grandes com precis√£o limitada. Ele √© "engolido" pelos bits da mantissa.

- Se $79 < \text{ULP} / 2$ ‚Üí √© **ignorado** (resultado √© `0.0`)
- Se $\text{ULP} / 2 < 79 < \text{ULP}$ ‚Üí √© **arredondado para a ULP** (resultado √© `64.0`, `128.0`, etc.)
- Se $79 \approx \text{ULP}$ ‚Üí soma √© arredondada para `x^{10} + 128`, subtra√ß√£o retorna `128.0`
- Apenas quando $79 \gg \text{ULP}$ o resultado √© de fato `79.0`

---

## ‚úÖ Conclus√£o

A opera√ß√£o:

$$
(x^{10} + 79) - x^{10}
$$

n√£o d√° `79` para `x` grande porque:

- $x^{10}$ √© enorme
- A ULP √© maior que `79`
- A soma `+79` √© arredondada ou ignorada
- A subtra√ß√£o resulta em `0`, `64`, `128`, etc.

Esses valores s√£o **m√∫ltiplos exatos de pot√™ncias de 2**, definidos pela ULP.

---

Se quiser, √© poss√≠vel gerar um gr√°fico de ULPs ao longo dos valores de $x^{10}$, ou mostrar c√≥digo para calcular `ULP(x)` diretamente.
